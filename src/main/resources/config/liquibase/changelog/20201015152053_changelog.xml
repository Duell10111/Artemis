<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.9.xsd">
    <changeSet author="stefanwaldhauser" id="1602768059583-42">
        <!-- Learning Goals -->
        <createTable tableName="learning_goal">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="learning_goalPK"/>
            </column>
            <column name="description" type="LONGTEXT"/>
            <column name="title" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="course_id" type="BIGINT"/>
        </createTable>
        <createTable tableName="learning_goal_exercise">
            <column name="learning_goal_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="exercise_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="learning_goal_order" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createTable tableName="learning_goal_lecture_module">
            <column name="learning_goal_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="lecture_module_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="learning_goal_order" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!-- Lecture Modules -->
        <createTable tableName="lecture_module">
            <column name="discriminator" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="lecture_modulePK"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="release_date" type="datetime(6)"/>
            <column name="markdown" type="LONGTEXT"/>
            <column name="description" type="LONGTEXT"/>
            <column name="source" type="LONGTEXT"/>
            <column name="lecture_id" type="BIGINT"/>
            <column name="exercise_id" type="BIGINT"/>
            <column name="lecture_module_order" type="INT"/>
        </createTable>
        <createTable tableName="attachment_module_attachment">
            <column name="attachment_module_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="attachment_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
        <!-- Foreign Key Constraints -->
        <addForeignKeyConstraint baseColumnNames="lecture_id" baseTableName="lecture_module"
                                 constraintName="FK2dy6vi10yy33r3348bv3ae6t3" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="lecture" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="learning_goal_id" baseTableName="learning_goal_lecture_module"
                                 constraintName="FKb741kk7s6yc03mqf7ckavp39j" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="learning_goal" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="lecture_module_id" baseTableName="learning_goal_lecture_module"
                                 constraintName="FKbtrs77k7ott272cfe3dqgatw3" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="lecture_module" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="attachment_module_id" baseTableName="attachment_module_attachment"
                                 constraintName="FKdc1liofmnl4r6wgmuwr9070fw" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="lecture_module" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="exercise_id" baseTableName="learning_goal_exercise"
                                 constraintName="FKdls9xttqemxxt0qljxop5v8rt" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="exercise" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="exercise_id" baseTableName="lecture_module"
                                 constraintName="FKe1yr5nflarwwg6fimw1pkb3mw" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="exercise" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="course_id" baseTableName="learning_goal"
                                 constraintName="FKlndcce3s82xwv8rumk2cjm2q0" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="course" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="attachment_id" baseTableName="attachment_module_attachment"
                                 constraintName="FKmdsqw2y9gw3eklir03mwlott3" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="attachment" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="learning_goal_id" baseTableName="learning_goal_exercise"
                                 constraintName="FKsqsxg20yruu16ca9x383wnhci" deferrable="false"
                                 initiallyDeferred="false"
                                 referencedColumnNames="id" referencedTableName="learning_goal" validate="true"/>
    </changeSet>
</databaseChangeLog>
